---
title: "Thermal Time"
output: html_document
---


```{r setup, echo = FALSE}
setup_qmd()
```

Daily thermal time for wheat based on [SubDailyInterpolation](/docs/Models/Functions/SubDailyInterpolation.qmd) with three cardinal temperature and [ThreeHourAirTemperature](/docs/Models/Functions/ThreeHourAirTemperature.qmd) interpolation method.

## Overview

The **Thermal Time** function in wheat model calculates the daily thermal time. This is crucial for crop development and organ growth. The model uses a sub-daily interpolation method to estimate air temperatures at three hourly interpolation method ([ThreeHourAirTemperature](/docs/Models/Functions/ThreeHourAirTemperature.qmd)), then applies a three cardinal temperature function to each interpolated temperature. These values are averaged to give a daily  thermal time used in phenological and growth calculations.


* `InterpolationMethod`: [ThreeHourAirTemperature](/docs/Models/Functions/ThreeHourAirTemperature.qmd) is used for sub-daily interpolation, i.e. 3-hourly temperature estimates.
* `Response`: Three cardinal temperature using [XYPairs](/docs/Models/Functions/XYPairs.qmd) to define the temperature response function. This function determines how effective the temperature is for thermal time accumulation.

| Cardinal Point | Description                | Value (°C) |
|:--------------:|:--------------------------|:----------:|
| Base           | Minimum for growth         | 0          |
| Optimum        | Maximum rate of growth     | 26         |
| Maximum        | Growth ceases above this   | 37         |

```{r plot-thermal-time, fig.height = 3, fig.cap="Thermal Time Function with Three Cardinal Temperatures"}
library(ggplot2)


x <- c(0, 26, 37)
y <- c(0, 26, 0)
x_out <- seq(-5, 40)
df <- data.frame(Temperature = x_out, 
                    Response = weaana::interpolationFunction(x, y, values = x_out))


ggplot(df, aes(x = Temperature, y = Response)) +
    geom_line(color = "darkorange", size = 1.2) +
    geom_vline(xintercept = x, linetype = "dashed", color = "grey50") +
    annotate("text", x = x[1], y = max(df$Response), label = "Base", vjust = -0.5, hjust = -0.1, size = 3) +
    annotate("text", x = x[2] - 3, y = max(df$Response), label = "Optimum", vjust = -0.5, hjust = 0.5, size = 3) +
    annotate("text", x = x[3], y = max(df$Response), label = "Maximum", vjust = -0.5, hjust = 1.1, size = 3) +
    labs(
        x = "Temperature (°C)",
        y = "Thermal Response"
    ) +
    theme_minimal()

```

## Cultivar-Specific Parameters

> In general, we do not modify the thermal time function for different cultivars. 

## Practical Example

> No practical example is provided for the thermal time function.


## Simulation Example

We demonstrate daily thermal time using [example simulations](docs/Crops/Wheat/Examples/wheat_example1.qmd) for wheat. The simulations are designed to illustrate how daily thermal times are calculated according to daily minimum and maximum temperatures.

The output variable `Wheat.Phenology.ThermalTime` is used to report the daily thermal time values, which represent the crop responses to daily temperature for development and growth. 

In the example below, we plot thermal time against days after sowing (Wheat.DaysAfterSowing) to visualize how thermal time accumulates throughout the season. The shape of the curve reflects temperature patterns during the growing period, with higher daily thermal time values typically corresponding to warmer days.

```{r fig-thermal-time, fig.cap="Thermal Time Simulation for Wheat Example 1. The blue and red lines represent daily minimum and maximum temperatures, respectively. The black line and symbols represent the thermal time accumulation for the cultivar 'Sunlamb' on the sowing date '1-May'."}
file <- "docs/Crops/Wheat/Examples/wheat_example1.apsimx"
pd <- read_example(file)

pd |> 
    dplyr::filter(Cultivar == "Sunlamb") |> 
    dplyr::filter(SowingDate == "1-May") |> 
    ggplot2::ggplot(ggplot2::aes(x = Wheat.DaysAfterSowing, y = Wheat.Phenology.ThermalTime)) +
    ggplot2::geom_line() +
    ggplot2::geom_line(ggplot2::aes(y = Weather.MinT), color = "blue") +
    ggplot2::geom_line(ggplot2::aes(y = Weather.MaxT), color = "red") +
    ggplot2::geom_point(ggplot2::aes(shape = Cultivar)) +
    ggplot2::facet_grid(Site ~ SowingDate) +
    ggplot2::theme_bw() +
    ggplot2::theme(legend.position = "bottom") 
```

This plot provides insight into how daily thermal time relates to daily minimum and maximum temperatures after sowing.
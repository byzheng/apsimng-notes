---
title: "ColdVrnResponse"
output: html_document
---

The `ColdVrnResponse` function models the upregulation of the *Vrn1* gene in response to cold temperatures. This function is an extension of the base *Vrn1* expression and represents how cold temperatures enhance vernalisation responses in cereal crops, as described in @brown_integration_2013. It is part of the vernalisation module used in the phenology model within APSIM NG.

## Overview

The `ColdVrnResponse` function calculates an additional contribution to *Vrn1* expression due to exposure to low temperatures, allowing plants to progress through their vernalisation requirement. It uses a temperature-dependent response, where expression increases exponentially with decreasing temperature. When temperatures exceed a threshold, the response is either reduced or suppressed, mimicking de-vernalisation effects. This function plays a crucial role in modeling development timing for cold-requiring cultivars.

It implements the `IFunction` and `IIndexedFunction` interfaces, and is used within the context of the [CAMP](CAMP.qmd) model for phase progression in phenology.

## Inputs

The following inputs are required by the function, supplied as child models or linked references:

- `CAMP`: The parent model that contains the parameters and context for the CAMP model.
- `k`: The exponential shape factor controlling the temperature response curve.
- `deVernalisationTemp`: The temperature threshold above which vernalisation is reduced.
- `deVernalisationRate`: The rate of down-regulation of *Vrn1* when temperature exceeds the de-vernalisation threshold.
- `camp.Params`: A parameter check from the CAMP model indicating whether computation is active.

## Methodology

The function computes the *Vrn1* upregulation for a given temperature $T$ (likely a sub-daily temperature). *Vrn1* expression is calculated after sowing as follows:


If temperature $T$ is less than devernalisation temperature $T_{\text{devernalisation}}$, Vrn expression is an exponential function of temperature and divided by 24 to convert from daily to hourly as the hourly interpolation is used in the model.

$$ \Delta Vrn1_{T} = \frac{e^{k \cdot T} }{24} $$

Where:

- $\Delta Vrn1_{T}$ is the upregulation of *Vrn1* from cold at temperature $T$,
- $k$ is the exponential shape factor for cold temperature response,
- $T$ is the temperature in degrees Celsius.

If temperature $T$ exceeds the de-vernalisation threshold $T_{\text{devernalisation}}$, the response is determined by down-regulation devernalisation rate through the parameter `deVernalisationRate` and divided by 24 to convert from daily to hourly as the hourly interpolation is used in the model:


$$ \Delta Vrn1_{T} = \frac{R_{\text{devernalisationRate}}}{24} $$

## Events 

**Events Listened For**

> No events are listened by this function.

**Events Raised to**

> No events are raised by this function.

## Properties

**Configurable and Reportable Properties**

| Property               | Type     | Description                                                                 |
|------------------------|----------|-----------------------------------------------------------------------------|
| k                      | IFunction | The exponential shape factor for cold temperature response.                 |
| deVernalisationTemp    | IFunction | Temperature above which de-vernalisation occurs.                            |
| deVernalisationRate    | IFunction | Rate of *Vrn1* downregulation above the temperature threshold.              |

**Read-Only Reportable Properties**

> No read-only properties are available for this function.

## User Interface

`ColdVrnResponse` can be added as a child of a `Function` node in the model tree. Right-click the parent node, select "Add Model...", and search for `ColdVrnResponse` in the Filter Box.

## Practical Example

In the wheat [CAMP model or LeavesInitiating phase](/docs/Crops/Wheat/Phenology/LeavesInitiating.qmd), the following parameters are used for the `ColdVrnResponse` function:

| Name                       | Description                                         | Value         |
|----------------------------|-----------------------------------------------------|---------------|
| k                          | Exponential shape factor for cold temperature response. | -0.17           |
| deVernalisationTemp        | Temperature above which de-vernalisation occurs.    | 20          |
| deVernalisationRate        | Rate of *Vrn1* downregulation above the temperature threshold. | 0          |


`deVernalisationRate` is set to 0, indicating that there is no down-regulation of *Vrn1* expression at temperatures above the de-vernalisation threshold (i.e. 20°C).

The upregulation of *Vrn1* from cold at temperature $T$ ($\Delta Vrn1_{T}$) is shown in the following plot.

```{r cold-vrn-response-example, fig.height = 3, fig.cap="Cold Vrn Response as a Function of Temperature"}
# Plot the cold Vrn response as a function of temperature
library(ggplot2)
x <- seq(-10, 40, by = 0.1)
y <- ifelse(x < 20, exp(-0.17 * x) / 24, 0)
df <- data.frame(temperature = x, cold_vrn_response = y)
ggplot(df, aes(x = temperature)) +
    geom_line(aes(y = cold_vrn_response)) +
    labs(
        x = "Temperature (°C)",
        y = "Cold Vrn Response (Vrn1 Upregulation)"
    ) +
    scale_x_continuous(breaks = seq(-10, 40, by = 5)) +
    theme_minimal()

```

## See Also

* **Source code:** [ColdVrnResponse.cs on GitHub](http://github.com/APSIMInitiative/ApsimX/blob/master/Models/PMF/Phenology/CAMP/ColdVrnResponse.cs)

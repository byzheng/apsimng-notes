---
title: "Photoperiod Effects on Heading Phase for Wheat in Australia"
format: html
sidebar: false
---


```{r setup, echo = FALSE}
setup_qmd()
```



[Photoperiod](/docs/Models/Functions/PhotoperiodFunction.qmd), or day length, is a key environmental factor influencing duration of ([Heading](/docs/Plants/Wheat/Phenology/Heading.qmd)) phase in wheat. In Australia, the wide range of latitudes means that day length varies significantly across the country and throughout the year. This variation impacts how quickly wheat plants develop.


```{r config}

library(ggplot2)

# Latitude range for Australia
lat_range <- c(-44, -10) # approx. southernmost to northernmost points

# Latitude of major Australian capital cities
city_lat <- data.frame(
    city = c("Sydney", "Melbourne", "Brisbane", "Perth", "Adelaide", "Hobart", "Darwin"),
    lat = c(-33.87, -37.81, -27.47, -31.95, -34.93, -42.88, -12.46),
    day = 1)
# Days of year
days <- seq(1, 365, by = 3)

# Create grid of latitude and day of year
lat_seq <- seq(lat_range[1], lat_range[2], by = 1)
grid <- expand.grid(lat = lat_seq, day = days)
```

## Day Length 

Australia spans a wide latitude range, from about 10째S (northern tip) to 44째S (southern tip, including Tasmania).

This range covers tropical to temperate climates, resulting in significant variation in day length and photoperiod effects across the country.

```{r day-length-calc}

grid$day_length <- mapply(weaana::dayLength, grid$day, grid$lat)
```

The day length is calculated with twilight angle of 6 degrees, which is commonly used in agricultural models to represent the start and end of daylight.

The day length varies from `r min(grid$day_length)` to `r max(grid$day_length)` hours across Australia, with the longest days occurring in summer (around December) and shortest in winter (around June).



```{r fig-day-length, fig.height = 5, fig.cap="Day Length Variation Across Australia" }


# Plot heatmap
ggplot(grid, aes(x = day, y = lat)) +
    geom_tile(aes(fill = day_length)) +
    geom_text(aes(label = city), data = city_lat, color = "black", size = 3, hjust = 0) +
    scale_x_continuous(
        breaks = as.numeric(format(seq(as.Date("1970-01-01"), as.Date("1970-12-01"), by = "1 month"), "%j")),
        labels = format(seq(as.Date("1970-01-01"), as.Date("1970-12-01"), by = "1 month"), "%d %b")
    ) +
    scale_fill_viridis_c(name = "Day Length (h)") +
    labs(x = "Day of Year", y = "Latitude (째)") +
    theme_minimal() +
    theme(legend.position = "bottom")
```


## Photoperiod Effects on Phyllochron


[Photoperiod](/docs/Models/Functions/PhotoperiodFunction.qmd), or day length, impacts on [Heading](/docs/Plants/Wheat/Phenology/Heading.qmd) phase when day length is shorter than 20 hours. 

| Day Length (h) | Modifier $\text{PpResponse}$ |
|----------------|-------------------|
| 6.0            | 1.0               |
| 8.0            | 1.0               |
| 20.0           | 0.0               |
| 22.0           | 0.0               |

```{r photoperiod-effect-calc}

x <- c(6, 8, 20, 22)
y <- c(1, 1, 0, 0)

for (i in seq(along = grid[[1]])) {
    grid$f_d[i] <- weaana::interpolationFunction(x, y, values = grid$day_length[i])
}

```

The calculated photoperiod effect $\text{PpResponse}$ is ranged from `r min(grid$f_d)` to `r max(grid$f_d)` mainly in winter and southern regions.

```{r fig-photoperiod-effect, fig.height = 5, fig.cap="Photoperiod Effect on heading phase"}


# Plot f_d (photoperiod effects) as a heatmap
grid |>
    dplyr::filter(f_d > 0) |>
    ggplot(aes(x = day, y = lat)) +
    geom_tile(aes(fill = f_d)) +
    geom_text(aes(label = city), data = city_lat, color = "black", size = 3, hjust = 0) +
    scale_fill_viridis_c(name = "Photoperiod Effect", limits = c(0, 1)) +
    scale_x_continuous(
        limits = c(1, 365),
        breaks = as.numeric(format(seq(as.Date("1970-01-01"), as.Date("1970-12-01"), by = "1 month"), "%j")),
        labels = format(seq(as.Date("1970-01-01"), as.Date("1970-12-01"), by = "1 month"), "%d %b")
    ) +
    labs(
        x = "Day of Year",
        y = "Latitude (째)"
    ) +
    theme_minimal() +
    theme(legend.position = "bottom")

```

Photoperiod impacts on wheat heading phase in all capital cities from late April to late August which is the major wheat growing season before flag leaf stage in Australia.

```{r fig-photoperiod-effect-city, fig.height = 5, fig.cap="Photoperiod Effect on Heading Phase for Capital Cities"}

i <- 1
for (i in seq(along = city_lat$city)) {
    city_lat$lat2[i] <- lat_seq[which.min(abs(lat_seq - city_lat$lat[i]))]
}



pd <- city_lat |> 
    dplyr::select(city, lat2)  |> 
    dplyr::left_join(grid, by = c("lat2" = "lat")) |> 
    tibble::tibble()
pd_label <- pd |> 
    dplyr::ungroup() |> 
    dplyr::group_by(city) |>
    dplyr::filter(day == 175)
pd |> 
    ggplot(aes(x = day, y = f_d, color = city)) +
    geom_line(size = 1) +
    geom_label(aes(label = city), data = pd_label, color = "black", size = 3) +
    scale_x_continuous(
        breaks = as.numeric(format(seq(as.Date("1970-01-01"), as.Date("1970-12-01"), by = "1 month"), "%j")),
        labels = format(seq(as.Date("1970-01-01"), as.Date("1970-12-01"), by = "1 month"), "%d %b")
    ) +
    labs(
        x = "Day of Year",
        y = "Photoperiod Effect (f_d)",
        color = "City"
    ) +
    guides(color = "none") +
    theme_minimal() +
    theme(legend.position = "bottom")
```

## Conclusion

Photoperiod plays a significant role in wheat development across Australia, particularly in the southern regions where day lengths are shorter during the growing season. This impacts the rate of Heading Phase, which is crucial for determining the timing of key growth stages such as flowering and maturity.
